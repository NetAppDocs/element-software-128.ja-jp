---
sidebar: sidebar 
permalink: upgrade/task_hcc_upgrade_element_prechecks.html 
summary: NetApp SolidFireストレージ システムのアップグレードの一環として、 NetApp Elementソフトウェアのヘルス チェックを実行する必要があります。 
keywords: netapp, storage prechecks, element upgrade, sfupgradecheck 
---
= ストレージをアップグレードする前に、Element ストレージのヘルスチェックを実行します。
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Element ストレージをアップグレードする前にヘルス チェックを実行して、クラスター内のすべてのストレージ ノードが次の Element ストレージ アップグレードの準備ができていることを確認する必要があります。

.要件
* *管理サービス*: 最新の管理サービス バンドル (2.10.27 以降) に更新されました。
+

IMPORTANT: Element ソフトウェアをアップグレードする前に、最新の管理サービス バンドルにアップグレードする必要があります。

* *管理ノード*:管理ノード 11.3 以降を実行しています。
* *Element ソフトウェア*: クラスター バージョンでは、 NetApp Elementソフトウェア 11.3 以降が実行されています。
* *エンド ユーザー ライセンス契約 (EULA)*: 管理サービス 2.20.69 以降では、 NetApp Hybrid Cloud Control UI または API を使用して Element ストレージ ヘルス チェックを実行する前に、EULA に同意して保存する必要があります。
+
.. Web ブラウザで管理ノードの IP アドレスを開きます。
+
[listing]
----
https://<ManagementNodeIP>
----
.. ストレージ クラスタ管理者の資格情報を入力して、 NetApp Hybrid Cloud Control にログインします。
.. インターフェースの右上近くにある*アップグレード*を選択します。
.. EULA がポップアップ表示されます。下にスクロールして、「*現在および今後のすべての更新に同意します*」を選択し、「*保存*」を選択します。




.ヘルスチェックオプション
NetApp Hybrid Cloud Control UI またはNetApp Hybrid Cloud Control API を使用してヘルスチェックを実行できます。

* <<NetApp Hybrid Cloud Controlを使用して、ストレージをアップグレードする前にElementストレージのヘルスチェックを実行します。>>（推奨方法）


サービスによって実行されるストレージ ヘルス チェックの詳細については、以下を参照してください。

* <<サービスによって行われたストレージのヘルスチェック>>




== NetApp Hybrid Cloud Controlを使用して、ストレージをアップグレードする前にElementストレージのヘルスチェックを実行します。

NetApp Hybrid Cloud Control を使用すると、ストレージ クラスターのアップグレードの準備ができていることを確認できます。

.手順
. Web ブラウザで管理ノードの IP アドレスを開きます。
+
[listing]
----
https://<ManagementNodeIP>
----
. ストレージ クラスタ管理者の資格情報を入力して、 NetApp Hybrid Cloud Control にログインします。
. インターフェースの右上近くにある*アップグレード*を選択します。
. *アップグレード*ページで、*ストレージ*タブを選択します。
. ヘルスチェックを選択image:hcc_healthcheck_icon.png["アイコン"]アップグレードの準備状況を確認するクラスターの場合。
. *ストレージ ヘルス チェック* ページで、*ヘルス チェックの実行* を選択します。
. 問題がある場合は、次の操作を行ってください。
+
.. 各問題について記載されている特定の KB 記事に移動する、または指定された解決策を実行します。
.. KB が指定されている場合は、関連する KB 記事に記載されているプロセスを完了します。
.. クラスターの問題を解決したら、「*ヘルスチェックの再実行*」を選択します。




ヘルスチェックがエラーなしで完了すると、ストレージ クラスターはアップグレードできる状態になります。ストレージノードのアップグレードを参照link:task_hcc_upgrade_element_software.html["確認方法"]続行します。



== ストレージをアップグレードする前に、API を使用して Element ストレージのヘルスチェックを実行します。

REST API を使用して、ストレージ クラスターのアップグレードの準備ができているかどうかを確認できます。ヘルス チェックでは、保留中のノード、ディスク領域の問題、クラスター障害など、アップグレードの障害がないことを確認します。

.手順
. ストレージ クラスター ID を見つけます。
+
.. 管理ノードで管理ノード REST API UI を開きます。
+
[listing]
----
https://<ManagementNodeIP>/mnode
----
.. *承認*を選択し、以下を完了します。
+
... クラスターのユーザー名とパスワードを入力します。
... クライアントIDを入力してください `mnode-client`値がまだ入力されていない場合。
... セッションを開始するには、[承認] を選択します。
... 認証ウィンドウを閉じます。


.. REST API UIから、 `GET /assets` 。
.. *試してみる*を選択します。
.. *実行*を選択します。
.. レスポンスから、 `"id"`から `"storage"`アップグレードの準備状況を確認するクラスターのセクション。
+

NOTE: 使用しないでください `"parent"`これはストレージ クラスターの ID ではなく、管理ノードの ID であるため、このセクションの値は使用できません。

+
[listing, subs="+quotes"]
----
"config": {},
"credentialid": "12bbb2b2-f1be-123b-1234-12c3d4bc123e",
"host_name": "SF_DEMO",
*"id": "12cc3a45-e6e7-8d91-a2bb-0bdb3456b789",*
"ip": "10.123.12.12",
"parent": "d123ec42-456e-8912-ad3e-4bd56f4a789a",
"sshcredentialid": null,
"ssl_certificate": null
----


. ストレージ クラスターでヘルス チェックを実行します。
+
.. 管理ノードでストレージ REST API UI を開きます。
+
[listing]
----
https://<ManagementNodeIP>/storage/1/
----
.. *承認*を選択し、以下を完了します。
+
... クラスターのユーザー名とパスワードを入力します。
... クライアントIDを入力してください `mnode-client`値がまだ入力されていない場合。
... セッションを開始するには、[承認] を選択します。
... 認証ウィンドウを閉じます。


.. *POST /health-checks* を選択します。
.. *試してみる*を選択します。
.. パラメータ フィールドに、手順 1 で取得したストレージ クラスター ID を入力します。
+
[listing]
----
{
  "config": {},
  "storageId": "123a45b6-1a2b-12a3-1234-1a2b34c567d8"
}
----
.. 指定されたストレージ クラスターでヘルス チェックを実行するには、[実行] を選択します。
+
応答は次のように状態を示す必要があります `initializing`:

+
[listing]
----
{
  "_links": {
    "collection": "https://10.117.149.231/storage/1/health-checks",
    "log": "https://10.117.149.231/storage/1/health-checks/358f073f-896e-4751-ab7b-ccbb5f61f9fc/log",
    "self": "https://10.117.149.231/storage/1/health-checks/358f073f-896e-4751-ab7b-ccbb5f61f9fc"
  },
  "config": {},
  "dateCompleted": null,
  "dateCreated": "2020-02-21T22:11:15.476937+00:00",
  "healthCheckId": "358f073f-896e-4751-ab7b-ccbb5f61f9fc",
  "state": "initializing",
  "status": null,
  "storageId": "c6d124b2-396a-4417-8a47-df10d647f4ab",
  "taskId": "73f4df64-bda5-42c1-9074-b4e7843dbb77"
}
----
.. コピー `healthCheckID`それは応答の一部です。


. ヘルスチェックの結果を確認します。
+
.. *GET ​/health-checks​/{healthCheckId}* を選択します。
.. *試してみる*を選択します。
.. パラメータ フィールドにヘルスチェック ID を入力します。
.. *実行*を選択します。
.. レスポンス本文の一番下までスクロールします。
+
すべてのヘルスチェックが成功した場合、返される結果は次の例のようになります。

+
[listing]
----
"message": "All checks completed successfully.",
"percent": 100,
"timestamp": "2020-03-06T00:03:16.321621Z"
----


. もし `message`戻り値がクラスターの健全性に関する問題があったことを示している場合は、次の操作を実行します。
+
.. *GET ​/health-checks​/{healthCheckId}/log* を選択します。
.. *試してみる*を選択します。
.. パラメータ フィールドにヘルスチェック ID を入力します。
.. *実行*を選択します。
.. 特定のエラーを確認し、関連する KB 記事のリンクを取得します。
.. 各問題について記載されている特定の KB 記事に移動する、または指定された解決策を実行します。
.. KB が指定されている場合は、関連する KB 記事に記載されているプロセスを完了します。
.. クラスターの問題を解決したら、*GET ​/health-checks​/{healthCheckId}/log* を再度実行します。






== サービスによって行われたストレージのヘルスチェック

ストレージ ヘルス チェックでは、クラスターごとに次のチェックが行われます。

|===
| 名前を確認 | ノード/クラスター | 説明 


| 非同期結果をチェックする | クラスタ | データベース内の非同期結果の数がしきい値を下回っていることを確認します。 


| クラスタ障害のチェック | クラスタ | アップグレードをブロックするクラスター障害がないことを確認します (Element ソースで定義)。 


| アップロード速度をチェックする | ノード | ストレージノードと管理ノード間のアップロード速度を測定します。 


| 接続速度チェック | ノード | ノードがアップグレード パッケージを提供する管理ノードに接続されていることを確認し、接続速度を推定します。 


| チェックコア | ノード | ノード上のカーネル クラッシュ ダンプとコア ファイルをチェックします。最近の期間 (しきい値 7 日間) 内のクラッシュについてはチェックが失敗します。 


| ルートディスクスペースのチェック | ノード | ルート ファイル システムにアップグレードを実行するのに十分な空き領域があることを確認します。 


| チェック変数ログディスクスペース | ノード | 検証する `/var/log`空き領域が、ある割合の空きしきい値を満たしています。そうでない場合、チェックはしきい値を下回るように古いログをローテーションして消去します。十分な空き領域を作成できない場合、チェックは失敗します。 


| チェック保留ノード | クラスタ | クラスターに保留中のノードがないことを確認します。 
|===
[discrete]
== 詳細情報の参照

* https://docs.netapp.com/us-en/element-software/index.html["SolidFireおよびElementソフトウェアのドキュメント"]
* https://docs.netapp.com/us-en/vcp/index.html["vCenter Server 用NetApp Elementプラグイン"^]

